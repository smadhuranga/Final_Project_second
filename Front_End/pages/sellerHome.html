<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Dashboard - UNI Freelancers</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --bg-dark: #0a0a0a;
      --bg-darker: #050505;
      --text-primary: #FFFFFF;
      --accent-blue: #25D3FF;
      --accent-purple: #A855F7;
      --success-green: #10B981;
      --danger-red: #EF4444;
      --text-secondary: rgba(255,255,255,0.7);
      --hover-primary: rgba(37, 211, 255, 0.1);
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-primary);
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
    }

    .dashboard-card {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 1.5rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(37, 211, 255, 0.1);
    }

    .nav-gradient {
      background: linear-gradient(90deg,
      rgba(40,40,40,0.95),
      rgba(20,20,20,0.95));
      backdrop-filter: blur(10px);
    }

    .orders-table {
      background: rgba(255,255,255,0.03);
      border-radius: 15px;
      overflow: hidden;
    }

    .status-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
    }

    .status-pending { background: rgba(239, 68, 68, 0.1); color: var(--danger-red); }
    .status-completed { background: rgba(16, 185, 129, 0.1); color: var(--success-green); }
    .status-progress { background: rgba(37, 211, 255, 0.1); color: var(--accent-blue); }

    .chat-box {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 350px;
      background: var(--bg-darker);
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transform: translateY(20px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .chat-box.active {
      transform: translateY(0);
      opacity: 1;
    }

    .chat-toggle {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--accent-purple);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(168, 85, 247, 0.3);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .chat-toggle:hover {
      transform: scale(1.1) rotate(15deg);
    }

    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }

    .message-bubble {
      background: rgba(255,255,255,0.05);
      border-radius: 15px;
      padding: 0.8rem 1rem;
      margin: 0.5rem 0;
      max-width: 80%;
    }

    .message-right {
      margin-left: auto;
      background: var(--accent-purple);
    }


    .nav-link {
      color: var(--text-secondary) !important;
      transition: all 0.3s ease;
    }

    .nav-link:hover {
      color: var(--accent-blue) !important;
      background: var(--hover-primary);
      border-radius: 8px;
    }

    .text-muted {
      color: var(--text-secondary) !important;
    }

    .modal-content {
      background: var(--bg-darker);
      border: 1px solid rgba(255,255,255,0.1);
    }
  </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark nav-gradient fixed-top">
  <div class="container">
    <a class="navbar-brand" href="#"><img src="../images/LOg.png" alt="Logo" style="height: 40px;"></a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="#dashboard">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="#orders">Orders</a></li>
        <li class="nav-item"><a class="nav-link" href="#services">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="#profile">Profile</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="container pt-5 mt-5">
  <!-- Dashboard Section -->
  <section id="dashboard" class="py-5">
    <h2 class="mb-4">Seller Dashboard</h2>
    <div class="row g-4">
      <div class="col-md-4">
        <div class="dashboard-card">
          <h5 class="text-muted">Total Earnings</h5>
          <h2 id="totalEarnings">$0.00</h2>
          <div class="progress mt-2" style="height: 4px;">
            <div class="progress-bar bg-success" style="width: 45%"></div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="dashboard-card">
          <h5 class="text-muted">Active Orders</h5>
          <h2 id="activeOrders">0</h2>
          <div class="progress mt-2" style="height: 4px;">
            <div class="progress-bar bg-primary" style="width: 30%"></div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="dashboard-card">
          <h5 class="text-muted">Avg. Rating</h5>
          <h2 id="avgRating">0.0</h2>
          <div class="stars mt-2">
            <i class="fas fa-star text-warning"></i>
            <i class="fas fa-star text-warning"></i>
            <i class="fas fa-star text-warning"></i>
            <i class="fas fa-star text-warning"></i>
            <i class="fas fa-star-half-alt text-warning"></i>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Management -->
  <section id="services" class="py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3>My Services</h3>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addServiceModal">
        <i class="fas fa-plus me-2"></i>Add New Service
      </button>
    </div>
    <div class="row g-4" id="servicesContainer">
      <!-- Services loaded via AJAX -->
    </div>
  </section>

  <!-- Order Management -->
  <section id="orders" class="py-5">
    <h3 class="mb-4">Recent Orders</h3>
    <div class="orders-table">
      <table class="table table-dark table-hover">
        <thead>
        <tr>
          <th>Order ID</th>
          <th>Service</th>
          <th>Price</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody id="ordersTable">
        <!-- Orders loaded via AJAX -->
        </tbody>
      </table>
    </div>
  </section>

  <!-- Profile Section -->
  <section id="profile" class="py-5">
    <div class="row">
      <div class="col-md-4">
        <div class="dashboard-card text-center">
          <img src="https://source.unsplash.com/random/300x300/?avatar"
               class="rounded-circle mb-3"
               alt="Avatar"
               style="width: 120px; height: 120px; object-fit: cover;">
          <h4 id="sellerName">John Doe</h4>
          <p class="text-muted" id="sellerRating">⭐ 0.0 (0 reviews)</p>
          <button class="btn btn-outline-primary w-100 mb-2"
                  data-bs-toggle="modal"
                  data-bs-target="#editProfileModal">
            Edit Profile
          </button>
          <button class="btn btn-outline-success w-100"
                  data-bs-toggle="modal"
                  data-bs-target="#withdrawModal">
            Withdraw Earnings
          </button>
        </div>
      </div>
      <div class="col-md-8">
        <div class="dashboard-card">
          <h4 class="mb-4">Profile Details</h4>
          <div class="row">
            <div class="col-md-6">
              <p><strong>Email:</strong> <span id="profileEmail">john@example.com</span></p>
              <p><strong>Location:</strong> <span id="profileLocation">New York, USA</span></p>
            </div>
            <div class="col-md-6">
              <p><strong>Member Since:</strong> <span id="memberSince">2023</span></p>
              <p><strong>Completed Orders:</strong> <span id="completedOrders">0</span></p>
            </div>
          </div>
          <h5 class="mt-4">Skills</h5>
          <div id="profileSkills" class="d-flex flex-wrap gap-2"></div>
        </div>
      </div>
    </div>
  </section>
</div>

<!-- Chat Interface -->
<div class="chat-toggle">
  <i class="fas fa-comments fa-lg"></i>
</div>
<div class="chat-box">
  <div class="chat-header p-3 border-bottom">
    <h5 class="mb-0">Messages</h5>
    <button class="btn btn-sm btn-close btn-close-white" onclick="$('.chat-box').removeClass('active')"></button>
  </div>
  <div class="chat-messages p-3" style="height: 300px; overflow-y: auto;">
    <div class="message-bubble">How can I help you today?</div>
    <div class="message-bubble message-right">I need some changes to my orders</div>
  </div>
  <div class="chat-input p-3">
    <div class="input-group">
      <input type="text" class="form-control" placeholder="Type message..." id="chatInput">
      <button class="btn btn-primary" id="sendMessage">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
</div>

<!-- Modals -->
<div class="modal fade" id="addServiceModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark">
      <div class="modal-header">
        <h5 class="modal-title">Add New Service</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form id="serviceForm">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Service Title</label>
            <input type="text" class="form-control" id="serviceTitle" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" id="serviceCategory" required>
              <option value="design">Design</option>
              <option value="development">Development</option>
              <option value="writing">Writing</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Price ($)</label>
            <input type="number" class="form-control" id="servicePrice" step="0.01" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" id="serviceDescription" rows="4" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Service</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Edit Service Modal -->
<div class="modal fade" id="editServiceModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark">
      <div class="modal-header">
        <h5 class="modal-title">Edit Service</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <form id="editServiceForm">
        <div class="modal-body">
          <input type="hidden" id="editServiceId">
          <div class="mb-3">
            <label class="form-label">Service Title</label>
            <input type="text" class="form-control" id="editServiceTitle" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Category</label>
            <select class="form-select" id="editServiceCategory" required>
              <option value="design">Design</option>
              <option value="development">Development</option>
              <option value="writing">Writing</option>
            </select>
          </div>
          <div class="mb-3">
            <label class="form-label">Price ($)</label>
            <input type="number" class="form-control" id="editServicePrice" step="0.01" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" id="editServiceDescription" rows="4" required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!--<script>-->
<!--  $(document).ready(function() {-->
<!--    let sampleServices = JSON.parse(localStorage.getItem('services')) || [-->
<!--      { id: 1, title: "Web Design", category: "design", price: 299, description: "Professional web design services" },-->
<!--      { id: 2, title: "Logo Design", category: "design", price: 99, description: "Custom logo creation" }-->
<!--    ];-->

<!--    let sampleOrders = JSON.parse(localStorage.getItem('orders')) || [-->
<!--      { id: 1001, service: "Web Design", price: 299, status: "Pending", statusClass: "status-pending" },-->
<!--      { id: 1002, service: "Logo Design", price: 99, status: "In Progress", statusClass: "status-progress" }-->
<!--    ];-->

<!--    // Initial load-->
<!--    loadDashboardData();-->
<!--    loadServices();-->
<!--    loadOrders();-->
<!--    loadProfileData();-->

<!--    // Chat functionality-->
<!--    $('.chat-toggle').click(() => $('.chat-box').toggleClass('active'));-->
<!--    $('#sendMessage').click(sendMessage);-->

<!--    function loadDashboardData() {-->
<!--      const totalEarnings = sampleOrders.reduce((sum, orders) => sum + orders.price, 0);-->
<!--      $('#totalEarnings').text(`$${totalEarnings.toFixed(2)}`);-->
<!--      $('#activeOrders').text(sampleOrders.length);-->
<!--    }-->

<!--    function loadServices() {-->
<!--      let html = '';-->
<!--      sampleServices.forEach(service => {-->
<!--        html += `-->
<!--                        <div class="col-md-4">-->
<!--                            <div class="dashboard-card">-->
<!--                                <h5>${service.title}</h5>-->
<!--                                <p class="text-muted">${service.category}</p>-->
<!--                                <div class="d-flex justify-content-between">-->
<!--                                    <span>$${service.price}</span>-->
<!--                                    <div>-->
<!--                                        <button class="btn btn-sm btn-outline-primary edit-service" data-id="${service.id}">-->
<!--                                            <i class="fas fa-edit"></i>-->
<!--                                        </button>-->
<!--                                        <button class="btn btn-sm btn-outline-danger delete-service" data-id="${service.id}">-->
<!--                                            <i class="fas fa-trash"></i>-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->
<!--                        </div>`;-->
<!--      });-->
<!--      $('#servicesContainer').html(html);-->
<!--      localStorage.setItem('services', JSON.stringify(sampleServices));-->
<!--    }-->

<!--    function loadOrders() {-->
<!--      let html = '';-->
<!--      sampleOrders.forEach(orders => {-->
<!--        html += `-->
<!--                        <tr>-->
<!--                            <td>#${orders.id}</td>-->
<!--                            <td>${orders.service}</td>-->
<!--                            <td>$${orders.price}</td>-->
<!--                            <td>-->
<!--                                <span class="status-badge ${orders.statusClass}">-->
<!--                                    ${orders.status}-->
<!--                                </span>-->
<!--                            </td>-->
<!--                            <td>-->
<!--                                <button class="btn btn-sm btn-outline-success deliver-orders" data-id="${orders.id}">-->
<!--                                    Deliver-->
<!--                                </button>-->
<!--                            </td>-->
<!--                        </tr>`;-->
<!--      });-->
<!--      $('#ordersTable').html(html);-->
<!--      localStorage.setItem('orders', JSON.stringify(sampleOrders));-->
<!--    }-->

<!--    // Service Form Handling-->
<!--    $('#serviceForm').submit(function(e) {-->
<!--      e.preventDefault();-->
<!--      const newService = {-->
<!--        id: Date.now(),-->
<!--        title: $('#serviceTitle').val(),-->
<!--        category: $('#serviceCategory').val(),-->
<!--        price: parseFloat($('#servicePrice').val()),-->
<!--        description: $('#serviceDescription').val()-->
<!--      };-->
<!--      sampleServices.push (newService);-->
<!--      loadServices();-->
<!--      $('#addServiceModal').modal('hide');-->
<!--      this.reset();-->
<!--    });-->

<!--    // Edit Service Handling-->
<!--    $(document).on('click', '.edit-service', function() {-->
<!--      const serviceId = $(this).data('id');-->
<!--      const service = sampleServices.find(s => s.id === serviceId);-->
<!--      $('#editServiceId').val(service.id);-->
<!--      $('#editServiceTitle').val(service.title);-->
<!--      $('#editServiceCategory').val(service.category);-->
<!--      $('#editServicePrice').val(service.price);-->
<!--      $('#editServiceDescription').val(service.description);-->
<!--      $('#editServiceModal').modal('show');-->
<!--    });-->

<!--    $('#editServiceForm').submit(function(e) {-->
<!--      e.preventDefault();-->
<!--      const serviceId = parseInt($('#editServiceId').val());-->
<!--      const updatedService = {-->
<!--        id: serviceId,-->
<!--        title: $('#editServiceTitle').val(),-->
<!--        category: $('#editServiceCategory').val(),-->
<!--        price: parseFloat($('#editServicePrice').val()),-->
<!--        description: $('#editServiceDescription').val()-->
<!--      };-->
<!--      const index = sampleServices.findIndex(s => s.id === serviceId);-->
<!--      sampleServices[index] = updatedService;-->
<!--      loadServices();-->
<!--      $('#editServiceModal').modal('hide');-->
<!--    });-->

<!--    // Delete Service Handling-->
<!--    $(document).on('click', '.delete-service', function() {-->
<!--      const serviceId = $(this).data('id');-->
<!--      if (confirm('Are you sure you want to delete this service?')) {-->
<!--        sampleServices = sampleServices.filter(s => s.id !== serviceId);-->
<!--        loadServices();-->
<!--      }-->
<!--    });-->

<!--    // Load Profile Data-->
<!--    function loadProfileData() {-->
<!--      $('#sellerName').text('John Doe');-->
<!--      $('#sellerRating').text('⭐ 4.8 (42 reviews)');-->
<!--      $('#profileEmail').text('john@example.com');-->
<!--      $('#profileLocation').text('New York, USA');-->
<!--      $('#memberSince').text('2022');-->
<!--      $('#completedOrders').text('38');-->
<!--      $('#profileSkills').html(`-->
<!--                    <span class="badge bg-primary">Web Design</span>-->
<!--                    <span class="badge bg-primary">UI/UX</span>-->
<!--                    <span class="badge bg-primary">Frontend Development</span>-->
<!--                `);-->
<!--    }-->

<!--    // Chat Functionality-->
<!--    function sendMessage() {-->
<!--      const message = $('#chatInput').val();-->
<!--      if (message.trim()) {-->
<!--        $('.chat-messages').append(`-->
<!--                        <div class="message-bubble message-right">${message}</div>-->
<!--                    `);-->
<!--        $('#chatInput').val('');-->
<!--        $('.chat-messages').scrollTop($('.chat-messages')[0].scrollHeight);-->
<!--      }-->
<!--    }-->

<!--    // Event Delegation for dynamic elements-->
<!--    $(document).on('click', '.deliver-orders', function() {-->
<!--      const orderId = $(this).data('id');-->
<!--      // Handle orders delivery logic here-->
<!--    });-->

<!--    // Initialize tooltips-->
<!--    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));-->
<!--    tooltipTriggerList.map(function(tooltipTriggerEl) {-->
<!--      return new bootstrap.Tooltip(tooltipTriggerEl);-->
<!--    });-->

<!--    // Sample message functionality-->
<!--    $('#chatInput').keypress(function(e) {-->
<!--      if (e.which === 13) { // Enter key-->
<!--        sendMessage();-->
<!--      }-->
<!--    });-->
<!--  });-->

<!--</script>-->


<script>
  $(document).ready(function() {
    // JWT Management
    let jwtToken = localStorage.getItem('jwtToken');
    let currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};

    // Set up AJAX defaults with JWT
    $.ajaxSetup({
      beforeSend: function(xhr) {
        if (jwtToken) {
          xhr.setRequestHeader('Authorization', 'Bearer ' + jwtToken);
        }
      }
    });

    // Initial Load
    if (jwtToken) {
      loadDashboardData();
      loadServices();
      loadOrders();
      loadProfileData();
    } else {
      window.location.href = '../index.html';
    }

    // Dashboard Data Load
    function loadDashboardData() {
      $.ajax({
        url: 'http://localhost:8080/api/v1/sellers/dashboard',
        method: 'GET',
        success: function(response) {
          if (response.code === 200) {
            $('#totalEarnings').text(`$${response.data.totalEarnings.toFixed(2)}`);
            $('#activeOrders').text(response.data.activeOrders);
            $('#avgRating').text(response.data.avgRating.toFixed(1));
          }
        },
        error: handleError
      });
    }

    // Services Management
    function loadServices() {
      $.ajax({
        url: 'http://localhost:8080/api/v1/services',
        method: 'GET',
        success: function(response) {
          if (response.code === 200) {
            renderServices(response.data);
          }
        },
        error: handleError
      });
    }

    function renderServices(services) {
      let html = '';
      services.forEach(service => {
        html += `
          <div class="col-md-4">
            <div class="dashboard-card">
              <h5>${service.title}</h5>
              <p class="text-muted">${service.category}</p>
              <div class="d-flex justify-content-between">
                <span>$${service.price}</span>
                <div>
                  <button class="btn btn-sm btn-outline-primary edit-service" data-id="${service.id}">
                    <i class="fas fa-edit"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger delete-service" data-id="${service.id}">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>`;
      });
      $('#servicesContainer').html(html);
    }

    // Service Form Handling
    $('#serviceForm').submit(function(e) {
      e.preventDefault();
      const serviceData = {
        title: $('#serviceTitle').val(),
        category: $('#serviceCategory').val(),
        price: parseFloat($('#servicePrice').val()),
        description: $('#serviceDescription').val()
      };

      $.ajax({
        url: 'http://localhost:8080/api/v1/services',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(serviceData),
        success: function(response) {
          if (response.code === 201) {
            loadServices();
            $('#addServiceModal').modal('hide');
            this.reset();
          }
        },
        error: handleError
      });
    });

    // Order Management
    function loadOrders() {
      $.ajax({
        url: 'http://localhost:8080/api/v1/orders',
        method: 'GET',
        success: function(response) {
          if (response.code === 200) {
            renderOrders(response.data);
          }
        },
        error: handleError
      });
    }

    function renderOrders(orders) {
      let html = '';
      orders.forEach(order => {
        html += `
          <tr>
            <td>#${order.id}</td>
            <td>${order.service}</td>
            <td>$${order.price}</td>
            <td>
              <span class="status-badge ${order.statusClass}">
                ${order.status}
              </span>
            </td>
            <td>
              <button class="btn btn-sm btn-outline-success deliver-order" data-id="${order.id}">
                Deliver
              </button>
            </td>
          </tr>`;
      });
      $('#ordersTable').html(html);
    }

    // Profile Management
    function loadProfileData() {
      $.ajax({
        url: 'http://localhost:8080/api/v1/sellers/me',
        method: 'GET',
        success: function(response) {
          if (response.code === 200) {
            const profile = response.data;
            $('#sellerName').text(profile.name);
            $('#sellerRating').text(`⭐ ${profile.avgRating} (${profile.reviewCount} reviews)`);
            $('#profileEmail').text(profile.email);
            $('#profileLocation').text(profile.location);
            $('#memberSince').text(new Date(profile.createdAt).getFullYear());
            $('#completedOrders').text(profile.completedOrders);
          }
        },
        error: handleError
      });
    }

    // Chat Functionality
    function sendMessage() {
      const message = $('#chatInput').val().trim();
      if (message) {
        $.ajax({
          url: 'http://localhost:8080/api/v1/chat',
          method: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({ message: message }),
          success: function() {
            $('.chat-messages').append(`
              <div class="message-bubble message-right">${message}</div>
            `);
            $('#chatInput').val('');
            $('.chat-messages').scrollTop($('.chat-messages')[0].scrollHeight);
          },
          error: handleError
        });
      }
    }

    // Error Handling
    function handleError(xhr) {
      const error = xhr.responseJSON;
      switch (xhr.status) {
        case 401:
          localStorage.clear();
          window.location.href = '../index.html';
          break;
        case 403:
          alert('You dont have permission for this action');
          break;
        default:
          alert(error?.message || 'An error occurred');
      }
    }

    // Event Listeners
    $('.chat-toggle').click(() => $('.chat-box').toggleClass('active'));
    $('#sendMessage').click(sendMessage);
    $('#chatInput').keypress(e => e.which === 13 && sendMessage());

    $(document).on('click', '.deliver-order', function() {
      const orderId = $(this).data('id');
      $.ajax({
        url: `http://localhost:8080/api/v1/orders/${orderId}/deliver`,
        method: 'PUT',
        success: function(response) {
          if (response.code === 200) loadOrders();
        },
        error: handleError
      });
    });

    $(document).on('click', '.delete-service', function() {
      const serviceId = $(this).data('id');
      if (confirm('Are you sure you want to delete this service?')) {
        $.ajax({
          url: `http://localhost:8080/api/v1/services/${serviceId}`,
          method: 'DELETE',
          success: function(response) {
            if (response.code === 200) loadServices();
          },
          error: handleError
        });
      }
    });

    // Logout Functionality
    $('#logoutButton').click(() => {
      localStorage.clear();
      window.location.href = '../index.html';
    });
  });
</script>
</body>
</html>